# คู่มือการตั้งค่าระบบล็อกอินที่เชื่อมต่อกับ Google Sheets

## ภาพรวม
ระบบล็อกอินใหม่จะดึงข้อมูลผู้ใช้จาก Google Sheets แทนการจำลองแบบเดิม ทำให้สามารถจัดการผู้ใช้ได้จริงผ่าน Google Sheets

## ขั้นตอนการตั้งค่า

### 1. สร้างตาราง Users ใน Google Sheets

1. เปิด Google Sheets ที่ใช้ในระบบ
2. สร้าง Sheet ใหม่ชื่อ "Users"
3. เพิ่มหัวคอลัมน์ตามลำดับ:
   ```
   email,password_hash,name,role,permissions,created_at,is_active,phone
   ```

4. เพิ่มข้อมูลผู้ใช้ตัวอย่าง:
   ```
   admin@lifescience.com,5d41402abc4b2a76b9719d911017c592,Administrator,admin,"read,write,delete,admin",2024-01-01T00:00:00Z,true,+66-2-123-4567
   user@lifescience.com,5d41402abc4b2a76b9719d911017c592,Lab Technician,user,"read,write",2024-01-15T09:00:00Z,true,+66-2-234-5678
   viewer@lifescience.com,5d41402abc4b2a76b9719d911017c592,Lab Viewer,viewer,"read",2024-02-01T08:30:00Z,true,+66-2-345-6789
   ```

### 2. อัปเดต Google Apps Script

1. เปิด Google Apps Script
2. แทนที่โค้ดเดิมด้วยไฟล์ `GoogleAppsScript_Complete.gs` ที่อัปเดตแล้ว
3. Deploy เป็น Web App ใหม่

### 3. รหัสผ่านเริ่มต้น

รหัสผ่านเริ่มต้นสำหรับผู้ใช้ตัวอย่างคือ: `hello`

### 4. โครงสร้างข้อมูลผู้ใช้

#### คอลัมน์ในตาราง Users:
- **email**: อีเมลของผู้ใช้ (Primary Key)
- **password_hash**: รหัสผ่านที่เข้ารหัสแล้ว
- **name**: ชื่อผู้ใช้
- **role**: บทบาท (admin, user, viewer)
- **permissions**: สิทธิ์การใช้งาน (read, write, delete, admin)
- **created_at**: วันที่สร้างบัญชี
- **is_active**: สถานะการใช้งาน (true/false)
- **phone**: เบอร์โทรศัพท์

#### บทบาทและสิทธิ์:
- **admin**: ผู้ดูแลระบบ - สิทธิ์เต็ม
- **user**: ผู้ใช้ทั่วไป - อ่านและเขียน
- **viewer**: ผู้ดู - อ่านอย่างเดียว

### 5. ฟีเจอร์ใหม่

#### สำหรับผู้ใช้ทั่วไป:
- ล็อกอินด้วยอีเมลและรหัสผ่านจริง
- ข้อมูลผู้ใช้ถูกดึงจาก Google Sheets

#### สำหรับผู้ดูแลระบบ:
- หน้า "จัดการผู้ใช้" ในเมนูหลัก
- เพิ่มผู้ใช้ใหม่
- แก้ไขข้อมูลผู้ใช้
- ลบผู้ใช้
- เปิด/ปิดการใช้งานบัญชีผู้ใช้

### 6. การใช้งาน

#### ล็อกอิน:
1. ไปที่หน้า Login
2. กรอกอีเมลและรหัสผ่าน
3. ระบบจะตรวจสอบกับ Google Sheets
4. หากถูกต้อง จะเข้าสู่ระบบ

#### จัดการผู้ใช้ (Admin เท่านั้น):
1. คลิก "จัดการผู้ใช้" ในเมนูหลัก
2. ดูรายการผู้ใช้ทั้งหมด
3. เพิ่ม/แก้ไข/ลบผู้ใช้ตามต้องการ

### 7. ความปลอดภัย

- รหัสผ่านถูกเข้ารหัสด้วย MD5 + Salt
- ข้อมูลผู้ใช้ถูกเก็บใน Google Sheets ที่ปลอดภัย
- มีการตรวจสอบสิทธิ์การเข้าถึงในแต่ละหน้า

### 8. การแก้ไขปัญหา

#### หากไม่สามารถล็อกอินได้:
1. ตรวจสอบว่า Google Apps Script ทำงานปกติ
2. ตรวจสอบข้อมูลในตาราง Users
3. ตรวจสอบรหัสผ่าน

#### หากไม่เห็นเมนู "จัดการผู้ใช้":
1. ตรวจสอบว่าผู้ใช้มีบทบาท "admin"
2. ตรวจสอบว่ามีสิทธิ์ "admin" ใน permissions

### 9. การพัฒนาต่อ

ระบบนี้รองรับการขยายฟีเจอร์เพิ่มเติม:
- การรีเซ็ตรหัสผ่าน
- การส่งอีเมลแจ้งเตือน
- การบันทึก Log การเข้าสู่ระบบ
- การตั้งค่าสิทธิ์แบบละเอียดมากขึ้น

## หมายเหตุ

- ระบบนี้ใช้การเข้ารหัสรหัสผ่านแบบง่าย (MD5) สำหรับการทดสอบ
- ในสภาพแวดล้อมการผลิตควรใช้การเข้ารหัสที่แข็งแกร่งกว่า เช่น bcrypt
- ควรมีการสำรองข้อมูลผู้ใช้เป็นประจำ
